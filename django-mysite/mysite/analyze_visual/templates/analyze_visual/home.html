{% extends "analyze_visual/base.html" %}

  {% block header %}
  <header id="header">
    <div class="container">

      <div id="logo" class="pull-left">
        <h1><a href="#intro" class="scrollto">New England</a></h1>
        <!-- Uncomment below if you prefer to use an image logo -->
        <!-- <a href="#intro"><img src="img/logo.png" alt="" title=""></a> -->
      </div>

      <nav id="nav-menu-container">
        <ul class="nav-menu">
          <li class="menu-active"><a href="#intro">Home</a></li>
          {% for v in visual %}<li><a href="#{{v.name}}">{{v.name}}</a></li>{% endfor %}
          <li class="menu-has-children"><a href="">States</a>
            <ul>
              {% for state in states %}<li><a href="#">{{state.state_name}}</a></li>{% endfor %}
            </ul>
          </li>
        </ul>
      </nav><!-- #nav-menu-container -->
    </div>
  </header><!-- #header -->
  {% endblock %}



{% block main %}
    {% for v in visual %}
    <section id="{{v.name}}">
      <div class="container">

        <div class="row">

          <div class="col-lg-8 offset-lg-4">
            <div class="section-header wow fadeIn" data-wow-duration="1s">
              <h3 class="section-title">{{v.title}}</h3>
              <span class="section-divider"></span>
            </div>
          </div>

          <div class="col-lg-4 col-md-5 features-img">
                <div id="container{{v.id}}"></div>
          </div>

          <div class="col-lg-8 col-md-7 ">

            <div class="row">

              <div class="col-lg-6 col-md-6 box wow fadeInRight">
                <div class="icon"><i class="ion-ios-speedometer-outline"></i></div>
                <h4 class="title"><a href="">Lorem Ipsum</a></h4>
                <p class="description">Voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident clarida perendo.</p>
              </div>
              <div class="col-lg-6 col-md-6 box wow fadeInRight" data-wow-delay="0.1s">
                <div class="icon"><i class="ion-ios-flask-outline"></i></div>
                <h4 class="title"><a href="">Dolor Sitema</a></h4>
                <p class="description">Minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat tarad limino ata noble dynala mark.</p>
              </div>
              <div class="col-lg-6 col-md-6 box wow fadeInRight" data-wow-delay="0.2s">
                <div class="icon"><i class="ion-social-buffer-outline"></i></div>
                <h4 class="title"><a href="">Sed ut perspiciatis</a></h4>
                <p class="description">Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur teleca starter sinode park ledo.</p>
              </div>
              <div class="col-lg-6 col-md-6 box wow fadeInRight" data-wow-delay="0.3s">
                <div class="icon"><i class="ion-ios-analytics-outline"></i></div>
                <h4 class="title"><a href="">Magni Dolores</a></h4>
                <p class="description">Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum dinoun trade capsule.</p>
              </div>
            </div>

          </div>

        </div>

      </div>

    </section><!-- #features -->
    {% endfor %}

{% endblock %}


{% block script %}
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://code.highcharts.com/maps/highmaps.js"></script>
<script src="https://code.highcharts.com/maps/modules/data.js"></script>
<script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
<script src="https://code.highcharts.com/maps/modules/offline-exporting.js"></script>
<script>
    
// Prepare random data
{% for v in visual %}
{% if v.chart_type == "GEO" %}
var data{{v.id}} = [
{% for statepop in v.indicator.first.state_pops%}["{{statepop.state.state_name}}",{{statepop.population}}],{% endfor %}
];
$.getJSON('https://data-incubator-yangx.c9users.io/geo_api?geo_type=all_state',
//$.getJSON('https://cdn.rawgit.com/highcharts/highcharts/057b672172ccc6c08fe7dbb27fc17ebca3f5b770/samples/data/germany.geo.json',
function (geojson) {
    // Initiate the chart
    Highcharts.mapChart('container{{v.id}}', {
        chart: {
            map: geojson
        },
        title: {
            text: '{{v.title}}'
        },
        mapNavigation: {
            enabled: true,
            buttonOptions: {
                verticalAlign: 'bottom'
            }
        },
        colorAxis: {
            tickPixelInterval: 100
        },
        series: [{
            data: data{{v.id}},
            keys: ['name', 'value'],
            joinBy: 'name',
            name: 'Population',
            states: {
                hover: {
                    color: '#a4edba'
                }
            },
            dataLabels: {
                enabled: true,
                format: '{point.properties.postal}'
            }
        }]
    });
});
{% endif %}
{% if v.chart_type == "BAR" %}
var index{{v.id}} = {
    {% for i in v.indicator.all %}
    '{{i.indicator_name}}':{ {% for j in i.state_pops %}'{{j.state.state_name}}':{{j.population}},{% endfor %}},
    {% endfor %}
}

s{{v.id}} = {}

for (var key in index2) {
  for (var ikey in index2[key]){
      try{
        s{{v.id}}[ikey].push(index2[key][ikey])
      }
      catch (error){
          s{{v.id}}[ikey] = [index2[key][ikey]]
      }
  }
}
var series{{v.id}} = []
for (var key in s{{v.id}}){
    series{{v.id}}.push({"name": key, "data":s{{v.id}}[key]});
}
Highcharts.chart('container{{v.id}}', {
    chart: {
        type: 'column'
    },
    title: {
        text: '{{v.title}}'
    },
    subtitle: {
        text: 'Source: census.gov'
    },
    xAxis: {
        categories: [
            {% for i in v.indicator.all %}'{{i.indicator_name}}',{% endfor %}
        ],
        crosshair: true
    },
    yAxis: {
        min: 0,
        title: {
            text: 'Population'
        }
    },
    tooltip: {
        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
            '<td style="padding:0"><b>{point.y:1f} population</b></td></tr>',
        footerFormat: '</table>',
        shared: true,
        useHTML: true
    },
    plotOptions: {
        column: {
            pointPadding: 0.2,
            borderWidth: 0
        }
    },
    series: series{{v.id}}
});
//{{v.indicator.first.state_pops.first.state|safe}}

{% endif %}
{% endfor %}
</script>


{% endblock %}